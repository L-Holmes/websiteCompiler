$gap: 10px;
$radius: 10px;
$pad: 10px;
$btn-pad: 6px 10px;

.filterable {
  width: 920px;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  position: relative;

  .filter-input,
  .aux-toggle,
  .ctrl-open {
    position: absolute;
    width: 1px;
    height: 1px;
    margin: -1px;
    border: 0;
    padding: 0;
    overflow: hidden;
    clip: rect(0 0 0 0);
    clip-path: inset(50%);
    white-space: nowrap;
  }

  .header {
    display: flex;
    gap: $gap;
    align-items: center;
    padding: $pad;
    background: #fff;
    border-radius: $radius;
    box-shadow: 0 8px 28px rgba(0,0,0,0.06);
    z-index: 2;
    position: relative;
  }

  .open-btn {
    cursor: pointer;
    user-select: none;
    font-weight: 700;
    margin-right: 6px;
  }

  .controls {
    display: flex;
    gap: 18px;
    align-items: center;
    margin-left: 8px;

    .group {
      display: flex;
      gap: 8px;
      align-items: center;

      .group-title { font-size: 12px; color: #666; margin-right: 6px; }

      .filter-btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: $btn-pad;
        border-radius: 8px;
        border: 1px solid #e6e6e6;
        background: #fafafa;
        cursor: pointer;
        font-weight: 600;
        transition: transform .12s ease, box-shadow .12s ease;
        &:hover { transform: translateY(-1px); }
      }

      .small { padding: 4px 8px; font-size: 13px; }
      .more-colours { display: none; gap: 6px; }

      #show-more-colours:checked ~ .header .controls .more-colours {
        display: flex;
      }
    }

    .product-types { display: none; }
    .subfilters { display: none; gap: 8px; align-items: center; }
  }

  .panel {
    margin-top: 14px;
    z-index: 1;

    .items {
      padding: $pad;
      background: #f8f8f9;
      border-radius: $radius;
      box-shadow: 0 12px 36px rgba(0,0,0,0.04);
      display: grid;
      gap: 8px;
    }

    .item {
      background: #fff;
      border: 1px solid #eee;
      padding: 10px;
      border-radius: 8px;
      display: block;
    }
  }

  // OR filtering
  .filter-input:checked ~ .panel .item { display: none; }

  #f-red:checked ~ .panel [data-tags~="red"],
  #f-blue:checked ~ .panel [data-tags~="blue"],
  #f-green:checked ~ .panel [data-tags~="green"],
  #f-yellow:checked ~ .panel [data-tags~="yellow"],
  #f-black:checked ~ .panel [data-tags~="black"],
  #cat-products:checked ~ .panel [data-category~="products"],
  #cat-services:checked ~ .panel [data-category~="services"],
  #shoe-shoes:checked ~ .panel [data-tags~="shoes"] {
    display: block;
  }

  // highlight active labels
  #f-red:checked ~ .header label[for="f-red"],
  #f-blue:checked ~ .header label[for="f-blue"],
  #f-green:checked ~ .header label[for="f-green"],
  #f-yellow:checked ~ .header label[for="f-yellow"],
  #f-black:checked ~ .header label[for="f-black"],
  #cat-products:checked ~ .header label[for="cat-products"],
  #cat-services:checked ~ .header label[for="cat-services"],
  #shoe-shoes:checked ~ .header label[for="shoe-shoes"] {
    background: #eef6ff;
    border-color: #cde0ff;
    box-shadow: 0 4px 10px rgba(22,90,255,0.06);
  }

  // show more colours
  #show-more-colours:checked ~ .header .controls .more-colours {
    display: flex;
  }

  // show product types only when Products checked
  #cat-products:checked ~ .header .controls .product-types {
    display: flex;
  }

  // show shoe subfilters only when Products + Shoes checked
  #cat-products:checked ~ #shoe-shoes:checked ~ .header .controls .subfilters {
    display: flex;
  }

  // progressive enhancement :has()
  @supports (selector(:has(*))) {
    &:has(#cat-products:checked) .product-types { display: flex; }
    &:has(#cat-products:checked):has(#shoe-shoes:checked) .subfilters { display: flex; }
  }
}
